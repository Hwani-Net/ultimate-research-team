<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Ultimate Research Team - Antigravity v11.2</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.57.0/build/stlite.css" />
    <style>
      #root { height: 100vh; }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script src="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.57.0/build/stlite.js"></script>
    <script>
      stlite.mount({
        requirements: ["crewai", "crewai-tools", "langchain-google-genai", "python-dotenv", "pydantic==2.10.6"],
        entrypoint: "app.py",
        files: {
          "app.py": "import streamlit as st\nimport os\nimport sys\nimport contextlib\nimport io\nimport re\nfrom crewai import Crew, Process\nfrom agents import UltimateResearchAgents\nfrom tasks import UltimateResearchTasks\nfrom dotenv import load_dotenv\nimport datetime\n\n# Page Config\nst.set_page_config(page_title=\"Ultimate Research Team (Gemini 2.5)\", page_icon=\"\ud83e\udde0\", layout=\"wide\")\n\n# Custom CSS for Premium Look & Real-time Logs\n# Theme Toggle Logic\n# Theme Toggle Logic\nif 'theme' not in st.session_state:\n    st.session_state.theme = 'Dark'\n\nwith st.sidebar:\n    # Use key='theme' for automatic session state management\n    st.radio(\"\ud83c\udf17 Theme Mode\", [\"Dark\", \"Light\"], horizontal=True, label_visibility=\"collapsed\", key=\"theme\")\n\n# Define Theme Palettes\nif st.session_state.theme == 'Dark':\n    primary_gradient = \"linear-gradient(135deg, #6366f1 0%, #a855f7 50%, #ec4899 100%)\"\n    bg_color = \"#05060f\"\n    bg_image = \"\"\"radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0, transparent 50%), \n                  radial-gradient(at 50% 0%, rgba(168, 85, 247, 0.1) 0, transparent 50%), \n                  radial-gradient(at 100% 0%, rgba(236, 72, 153, 0.15) 0, transparent 50%)\"\"\"\n    text_color = \"#f1f5f9\"\n    glass_bg = \"rgba(13, 14, 22, 0.7)\"\n    glass_border = \"rgba(255, 255, 255, 0.08)\"\n    # Use background property for gradient\n    sidebar_css = \"\"\"\n        background: linear-gradient(180deg, \n        rgba(10, 11, 20, 0.98) 0%, \n        rgba(20, 15, 45, 0.95) 50%,\n        rgba(10, 11, 20, 0.98) 100%) !important;\n    \"\"\"\n    console_bg = \"rgba(0, 0, 0, 0.8)\"\n    console_text = \"#5eead4\"\n    report_bg = \"rgba(255, 255, 255, 0.02)\"\n    \nelse:  # Light Mode (High Readability)\n    primary_gradient = \"linear-gradient(135deg, #4f46e5 0%, #9333ea 50%, #db2777 100%)\" # Slightly darker for contrast\n    bg_color = \"#f8fafc\" # Slate 50\n    bg_image = \"\"\"radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.05) 0, transparent 50%), \n                  radial-gradient(at 100% 0%, rgba(236, 72, 153, 0.05) 0, transparent 50%)\"\"\"\n    text_color = \"#1e293b\" # Slate 800\n    glass_bg = \"rgba(255, 255, 255, 0.75)\"\n    glass_border = \"rgba(0, 0, 0, 0.15)\" # Slightly darker border for visibility\n    # Use background-color and remove background-image\n    sidebar_css = \"\"\"\n        background-color: #ffffff !important;\n        background-image: none !important;\n    \"\"\"\n    console_bg = \"#1e1e1e\" # Keep console dark for code readability\n    console_text = \"#a5f3fc\"\n    report_bg = \"rgba(255, 255, 255, 0.6)\"\n\nst.markdown(f\"\"\"\n<style>\n@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&family=Space+Grotesk:wght@300;500;700&display=swap');\n\n:root {{\n    --primary-gradient: {primary_gradient};\n    --glass-bg: {glass_bg};\n    --glass-border: {glass_border};\n    --accent-glow: 0 0 20px rgba(139, 92, 246, 0.3);\n    --text-color: {text_color};\n    --console-bg: {console_bg};\n    --console-text: {console_text};\n    --report-bg: {report_bg};\n}}\n\n/* Global Text Reset - Aggressive */\nhtml, body, [class*=\"css\"] {{\n    font-family: 'Outfit', sans-serif;\n    color: var(--text-color) !important;\n}}\n\n/* Main Background */\n.stApp {{\n    background-color: {bg_color};\n    background-image: {bg_image};\n    background-attachment: fixed;\n}}\n\n/* Sidebar - Force Override */\n[data-testid=\"stSidebar\"] {{\n    {sidebar_css}\n    border-right: 1px solid var(--glass-border);\n    box-shadow: 10px 0 30px rgba(0, 0, 0, 0.05);\n}}\n\n[data-testid=\"stSidebar\"] * {{\n    color: var(--text-color) !important;\n}}\n\n/* Markdown Text Specifics */\n.stMarkdown p, .stMarkdown li, .stMarkdown span {{\n    color: var(--text-color) !important;\n    font-size: 1.05em;\n    line-height: 1.6;\n}}\n\nh1, h2, h3, h4, h5, h6 {{\n    font-family: 'Space Grotesk', sans-serif;\n    color: var(--text-color) !important;\n    font-weight: 800 !important;\n    letter-spacing: -0.5px;\n}}\n\n/* Glass Cards */\n.glass-card {{\n    background: var(--glass-bg);\n    backdrop-filter: blur(20px);\n    -webkit-backdrop-filter: blur(20px);\n    border: 1px solid var(--glass-border);\n    border-radius: 24px;\n    padding: 28px;\n    margin-bottom: 24px;\n    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\n}}\n\n/* Buttons */\n.stButton > button {{\n    width: 100%;\n    border-radius: 12px;\n    height: 3.5em;\n    background: var(--primary-gradient);\n    color: white !important;\n    font-weight: 700;\n    border: none;\n    transition: transform 0.2s;\n}}\n\n.stButton > button:hover {{\n    transform: translateY(-2px);\n    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);\n    color: white !important;\n}}\n\n/* Inputs & Selectboxes */\n.stTextInput > div > div > input,\n.stTextArea > div > div > textarea,\n.stSelectbox > div > div > div {{\n    background-color: var(--glass-bg) !important;\n    color: var(--text-color) !important;\n    caret-color: var(--text-color) !important; /* Fix cursor visibility */\n    border: 1px solid var(--glass-border) !important;\n    border-radius: 12px;\n}}\n\n.stTextInput > div > div > input::placeholder,\n.stTextArea > div > div > textarea::placeholder {{\n    color: var(--text-color) !important;\n    opacity: 0.5;\n}}\n\n/* Code Blocks & Terminal */\n[data-testid=\"stCode\"] {{\n    background-color: var(--console-bg) !important;\n    border-radius: 12px;\n    border: 1px solid var(--glass-border);\n    padding: 10px;\n}}\n\n[data-testid=\"stCode\"] pre {{\n    background-color: transparent !important;\n    border: none !important;\n}}\n\n[data-testid=\"stCode\"] code {{\n    background-color: transparent !important;\n    font-family: 'JetBrains Mono', monospace !important;\n    color: var(--console-text) !important; /* Force text color */\n}}\n\n/* Override potential syntax highlighting spans that might be invisible */\n[data-testid=\"stCode\"] span {{\n    color: inherit;\n}}\n\n/* Console Box */\n.console-box {{\n    background-color: {console_bg};\n    color: {console_text} !important;\n    padding: 20px;\n    border-radius: 16px;\n    font-family: 'JetBrains Mono', monospace;\n    height: 500px;\n    overflow-y: auto;\n    font-size: 0.85em;\n    border: 1px solid rgba(139, 92, 246, 0.2);\n}}\n\n/* Report Card */\n.report-card {{\n    background: {report_bg};\n    padding: 30px;\n    border-radius: 20px;\n    border: 1px solid var(--glass-border);\n    color: var(--text-color) !important;\n}}\n\n/* Expander Styling */\n[data-testid=\"stExpander\"] {{\n    border: none !important;\n    box-shadow: none !important;\n}}\n\n[data-testid=\"stExpander\"] details {{\n    border-color: var(--glass-border) !important;\n    background-color: var(--glass-bg) !important;\n    border-radius: 12px;\n    color: var(--text-color) !important;\n}}\n\n[data-testid=\"stExpander\"] summary {{\n    background-color: transparent !important;\n    color: var(--text-color) !important;\n    font-weight: 600 !important;\n}}\n\n[data-testid=\"stExpander\"] summary:hover {{\n    color: var(--text-color) !important;\n    opacity: 0.8;\n}}\n\n[data-testid=\"stExpander\"] summary p, \n[data-testid=\"stExpander\"] summary span,\n[data-testid=\"stExpander\"] summary svg {{\n    color: var(--text-color) !important;\n    fill: var(--text-color) !important;\n}}\n\n/* Links */\na {{\n    color: #8b5cf6 !important;\n    text-decoration: none;\n    font-weight: 600;\n}}\n\n/* Model Guide Badge */\n.model-badge {{\n    display: inline-block;\n    padding: 6px 14px;\n    border-radius: 10px;\n    font-size: 0.75em;\n    font-weight: 800;\n    margin-right: 8px;\n    text-transform: uppercase;\n    letter-spacing: 1.5px;\n    background: rgba(30, 41, 59, 0.1);\n    border: 1px solid var(--glass-border);\n    backdrop-filter: blur(5px);\n}}\n.badge-pro {{ color: #fbbf24; border-color: rgba(251, 191, 36, 0.3); background: rgba(251, 191, 36, 0.1); }}\n.badge-flash {{ color: #34d399; border-color: rgba(52, 211, 153, 0.3); background: rgba(52, 211, 153, 0.1); }}\n.badge-opus {{ color: #f87171; border-color: rgba(248, 113, 113, 0.3); background: rgba(248, 113, 113, 0.1); }}\n\n.status-banner {{\n    background: linear-gradient(90deg, rgba(99, 102, 241, 0.2), rgba(236, 72, 153, 0.2));\n    border: 1px solid var(--glass-border);\n    padding: 10px 20px;\n    border-radius: 12px;\n    text-align: center;\n    font-weight: 600;\n    font-size: 0.9em;\n    margin-bottom: 30px;\n    animation: pulse-glow 3s infinite;\n    color: var(--text-color);\n}}\n\n/* Input Fields */\n.stTextArea textarea {{\n    background-color: var(--glass-bg) !important;\n    color: var(--text-color) !important;\n    border: 1px solid var(--glass-border) !important;\n}}\n\n/* Modal Dialog Customization for Dark Mode */\ndiv[data-testid=\"stDialog\"] {{\n    background-color: #1e1e2f !important; /* Dark background */\n    color: #ffffff !important;\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    box-shadow: 0 10px 30px rgba(0,0,0,0.5);\n}}\n\ndiv[data-testid=\"stDialog\"] p, \ndiv[data-testid=\"stDialog\"] h1,\ndiv[data-testid=\"stDialog\"] h2,\ndiv[data-testid=\"stDialog\"] h3 {{\n    color: #ffffff !important;\n}}\n\n/* Modal TextArea specific override */\ndiv[data-testid=\"stDialog\"] textarea {{\n    background-color: rgba(0, 0, 0, 0.3) !important;\n    color: #e0e0e0 !important;\n    border: 1px solid rgba(255, 255, 255, 0.2) !important;\n    font-size: 1.05em !important;\n    line-height: 1.5 !important;\n}}\n\ndiv[data-testid=\"stDialog\"] button[kind=\"secondary\"] {{\n    background-color: rgba(255, 255, 255, 0.1) !important;\n    color: #ffffff !important;\n    border: 1px solid rgba(255, 255, 255, 0.2) !important;\n}}\n\ndiv[data-testid=\"stDialog\"] button[kind=\"secondary\"]:hover {{\n    background-color: rgba(255, 255, 255, 0.2) !important;\n    border: 1px solid rgba(255, 255, 255, 0.5) !important;\n}}\n\n/* Force Widget Labels High Visibility */\n[data-testid=\"stWidgetLabel\"], \n[data-testid=\"stWidgetLabel\"] p,\nlabel[data-baseweb=\"checkbox\"] span,\nlabel[data-baseweb=\"radio\"] div {{\n    color: var(--text-color) !important;\n    font-weight: 600 !important;\n    opacity: 1 !important;\n}}\n\n/* File Uploader Customization */\n[data-testid=\"stFileUploader\"] {{\n    background-color: var(--glass-bg) !important;\n    border-radius: 16px;\n    padding: 10px;\n    border: 1px dashed var(--glass-border);\n}}\n\n[data-testid=\"stFileUploaderDropzone\"] {{\n    background-color: rgba(255, 255, 255, 0.03) !important;\n    border: none !important;\n}}\n\n/* File Uploader Text & Icons */\n[data-testid=\"stFileUploaderDropzone\"] div div span,\n[data-testid=\"stFileUploaderDropzone\"] div div small {{\n    color: var(--text-color) !important;\n    opacity: 0.9 !important;\n}}\n\n/* Uploaded File List */\n[data-testid=\"stUploadedFile\"] {{\n    background-color: rgba(255, 255, 255, 0.05) !important;\n    border-radius: 10px;\n    margin-top: 5px;\n    padding: 8px;\n}}\n\n[data-testid=\"stUploadedFile\"] span,\n[data-testid=\"stUploadedFile\"] svg {{\n    color: var(--text-color) !important;\n}}\n\n/* File Uploader Error Message visibility */\n[data-testid=\"stErrorMessage\"] {{\n    background-color: rgba(255, 75, 75, 0.1) !important;\n    border: 1px solid rgba(255, 75, 75, 0.3) !important;\n    color: #ff4b4b !important;\n    border-radius: 10px;\n}}\n\n[data-testid=\"stErrorMessage\"] p {{\n    color: #ff4b4b !important;\n    font-weight: 600;\n}}\n\n.stSelectbox div[data-baseweb=\"select\"] > div {{\n    background-color: var(--glass-bg) !important;\n    color: var(--text-color) !important;\n    border: 1px solid var(--glass-border) !important;\n}}\n\n/* Custom Scrollbar */\n::-webkit-scrollbar {{ width: 8px; }}\n::-webkit-scrollbar-track {{ background: transparent; }}\n::-webkit-scrollbar-thumb {{ \n    background: rgba(139, 92, 246, 0.3); \n    border-radius: 10px; \n}}\n::-webkit-scrollbar-thumb:hover {{ background: rgba(139, 92, 246, 0.5); }}\n</style>\n\"\"\", unsafe_allow_html=True)\n\nload_dotenv()\n\n# Streamlit-compatible stdout capturing\nclass StreamlitCallbackHandler:\n    def __init__(self, container):\n        self.container = container\n        self.text = \"\"\n\n    def write(self, data):\n        # Remove ANSI escape sequences (colors) from terminal output\n        clean_text = re.sub(r'\\x1B(?:[@-Z\\\\-_]|\\[[0-?]*[ -/]*[@-~])', '', data)\n        self.text += clean_text\n        self.container.markdown(f'<div class=\"console-box\">{self.text}</div>', unsafe_allow_html=True)\n    \n    def flush(self):\n        pass\n\ndef run_research(topic, log_container, image_data=None, research_mode=\"Deep Strategy (5-Agent)\"):\n    # Setup stdout redirect\n    handler = StreamlitCallbackHandler(log_container)\n    \n    with contextlib.redirect_stdout(handler):\n        print(f\"\ud83c\udfaf [MISSION STARTED] Processing User Command: \\\"{topic}\\\"\")\n        print(\"--------------------------------------------------\")\n        \n        # 1. Instantiate Agents\n        agents = UltimateResearchAgents()\n        \n        # Common Agents\n        researcher = agents.deep_researcher()\n        writer = agents.insight_synthesizer()\n        \n        # 2. Instantiate Tasks\n        tasks = UltimateResearchTasks()\n        \n        if research_mode == \"Speed Briefing (3-Agent)\":\n            # 3-Agent Flow: Research -> Critic -> Writer\n            critic = agents.chief_skeptic() # Re-using skeptic as critic\n            \n            t1 = tasks.initial_research_task(researcher, topic, image_data)\n            # Utilizing a simplified critique task (need to ensure this exists or use debate task in a simple way)\n            # For compatibility, we will use the debate task but purely for critique if we want, \n            # OR we can add a specific simple critique task back to tasks.py if needed. \n            # However, looking at the previous edit, I overwrote tasks.py. \n            # So I will use the 'debate_task' but instruct the agent to keep it brief, \n            # OR I will just use the research and direct writing for maximum speed?\n            # Let's stick to the 3-agent structure: Research -> Debate(Critic) -> Write.\n            \n            t2 = tasks.debate_task(critic) # Using Skeptic for critique\n            t3 = tasks.final_report_task(writer, topic)\n            \n            crew = Crew(\n                agents=[researcher, critic, writer],\n                tasks=[t1, t2, t3],\n                verbose=True,\n                process=Process.sequential,\n                memory=False\n            )\n            \n        else:\n            # 5-Agent Flow: Research -> Data -> Debate -> Biz -> Writer\n            analyst = agents.data_analyst()\n            skeptic = agents.chief_skeptic()\n            strategist = agents.business_consultant()\n            \n            t1 = tasks.initial_research_task(researcher, topic, image_data)\n            t2 = tasks.data_visualization_task(analyst)\n            t3 = tasks.debate_task(skeptic)\n            t4 = tasks.business_logic_task(strategist)\n            t5 = tasks.final_report_task(writer, topic)\n\n            crew = Crew(\n                agents=[researcher, analyst, skeptic, strategist, writer],\n                tasks=[t1, t2, t3, t4, t5],\n                verbose=True,\n                process=Process.sequential,\n                memory=False \n            )\n\n        return crew.kickoff()\n\n# Sidebar: System Guide\nwith st.sidebar:\n    st.image(\"https://img.icons8.com/wired/256/ffffff/brain.png\", width=80)\n    st.title(\"Admin Panel\")\n    \n    with st.expander(\"\ud83e\udd16 \uace0\uae09 \uba54\ud0c0-\ud504\ub86c\ud504\ud2b8 \uc0dd\uc131\uae30\", expanded=False):\n        meta_prompt = \"\"\"[System Instruction for AI]\n\ub108\ub294 'AI \uc5d0\uc774\uc804\ud2b8 \uc624\ucf00\uc2a4\ud2b8\ub808\uc774\ud130'\uc57c. \uc544\ub798 \uc8fc\uc81c\uc5d0 \ub300\ud574 5\uc778 \uc5d0\uc774\uc804\ud2b8 \ud300(Research-Data-Debate-Biz-Writer)\uc774 \uc218\ud589\ud560 '\ucd5c\uc885 \uc9c0\uc2dc\uc11c'\ub97c \uc791\uc131\ud574\uc918.\n\n1. \ub9ac\uc11c\uce58 \uc8fc\uc81c: [\uc8fc\uc81c \uc785\ub825]\n2. \uc5d0\uc774\uc804\ud2b8 \ud398\ub974\uc18c\ub098: \uc804\ub7b5 \ucee8\uc124\ud305 \ud38c \uc2dc\ub2c8\uc5b4 \ud30c\ud2b8\ub108 \uc218\uc900\n3. \ube44\ud3c9\uac00 \ud2b9\uc218 \uc9c0\uc2dc: '\uc801\ub300\uc801 \uac80\uc99d(Adversarial Thinking)'\uc744 \uac00\ub3d9\ud558\uc5ec \ub9ac\uc11c\uce58 \ub370\uc774\ud130\uc758 \ud5c8\uc810\uc744 \ud30c\ud5e4\uce60 \uc218 \uc788\ub3c4\ub85d \uad6c\uc131\ud560 \uac83\n4. \ud55c\uad6d \uc0ac\uc6a9\uc790 \ubc30\ub824: \ubaa8\ub4e0 \ubcf4\uace0\uc11c\uc758 \ucd5c\uc885 \ub2e8\uacc4\uc5d0 \ud55c\uae00 \uc0c1\uc138 \uc694\uc57d \ubc0f \ubc88\uc5ed \uc139\uc158\uc744 \ud3ec\ud568\ud558\ub3c4\ub85d \uac15\uc81c\ud560 \uac83\n\n[\ucd9c\ub825 \ud615\uc2dd]\n- Researcher\ub97c \uc704\ud55c \uac80\uc0c9 \ucffc\ub9ac \ubc0f \uc911\uc810 \uc870\uc0ac \ud56d\ubaa9\n- Data Analyst\ub97c \uc704\ud55c \ucc28\ud2b8/\uadf8\ub798\ud504 \ub370\uc774\ud130 \ucd94\ucd9c \ud3ec\uc778\ud2b8\n- Chief Skeptic\uc744 \uc704\ud55c \ud1a0\ub860 \uc8fc\uc81c (\ub099\uad00 vs \ube44\uad00)\n- Business Strategist\ub97c \uc704\ud55c \uc218\uc775\uc131 \ubaa8\ub378 \ubc0f \uc2e4\ud589 \uacc4\ud68d\n- Writer\ub97c \uc704\ud55c \ubcf4\uace0\uc11c \uad6c\uc870(Outline) \uc81c\uc548\"\"\"\n        \n        st.markdown(\"**1. \uc544\ub798 \ud15c\ud50c\ub9bf \ubcf5\uc0ac & \uc678\ubd80 AI(ChatGPT \ub4f1)\uc5d0 \uc785\ub825**\")\n        st.code(meta_prompt, language=\"markdown\")\n        st.success(\"\uc678\ubd80 AI\uac00 \ub9cc\ub4e4\uc5b4\uc900 \uc0c1\uc138 \uc9c0\uc2dc\uc11c\ub97c [Research Mission] \uce78\uc5d0 \ub123\uc73c\uc138\uc694.\")\n\n    with st.expander(\"\ud83d\udcd6 \uc774\uc6a9 \uac00\uc774\ub4dc & \ud301\"):\n        st.markdown(\"\"\"\n        ### \ud83c\udfaf \uace0\ud488\uc9c8 \ubcf4\uace0\uc11c \ubc1b\ub294 \ubc95\n        **1. \uad6c\uccb4\uc801\uc778 \ud398\ub974\uc18c\ub098 \ubd80\uc5ec**\n        - \"\ucee8\uc124\ud134\ud2b8\ucc98\ub7fc\" \ud639\uc740 \"\ubcc0\ud638\uc0ac\ucc98\ub7fc\" \ud589\ub3d9\ud558\ub77c\uace0 \uc9c0\uc2dc\ud558\uc138\uc694.\n        **2. \uc801\ub300\uc801 \ube44\ud3c9 \uac15\uc81c**\n        - \"\ube44\ud3c9\uac00\ub294 \ubb34\uc870\uac74 \ub9ac\uc11c\ucc98\uc758 \uc758\uacac\uc5d0 \ubc18\ubc15\ud574\"\ub77c\ub294 \uc9c0\uce68\uc774 \ud6a8\uacfc\uc801\uc785\ub2c8\ub2e4.\n        **3. 2024-2026 \uc6d0\uce59**\n        - \ucd5c\uc2e0 \uc815\ubcf4\ub97c \ucc3e\uae30 \uc704\ud574 \ub0a0\uc9dc \ubc94\uc704\ub97c \uba85\uc2dc\ud574 \uc8fc\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.\n        ---\n        \u26a0\ufe0f **\uc138\uc158 \uad00\ub9ac**: \uc8fc\uc81c\ub97c \ubc14\uafc0 \ub550 \ubc18\ub4dc\uc2dc **[Reset Session]** \ud639\uc740 **\ud130\ubbf8\ub110\uc744 \uc7ac\uc2dc\uc791**\ud558\uc138\uc694.\n        \"\"\")\n\n    with st.expander(\"\ud83d\udef8 Antigravity \ub9c8\uc2a4\ud130 \ub9e4\ub274\uc5bc (\ubf1b\uc18d\uae4c\uc9c0 \ubd80\ub824\uba39\uae30)\", expanded=True):\n        st.markdown(\"\"\"\n        ### \ud83d\udc80 \uccab \ub300\ud654\ubd80\ud130 AI\ub97c \uc0ac\uace8\ub85c \uc6b0\ub824\uba39\ub294 \ubc95\n        \n        \uc544\ub798 \ud504\ub86c\ud504\ud2b8\ub97c **\uc0c8 \ub300\ud654 \uc2dc\uc791 \uc2dc \ud1b5\uc9f8\ub85c \ubcf5\uc0ac+\ubd99\uc5ec\ub123\uae30** \ud558\uc138\uc694.\n        \uc774 \uc21c\uac04\ubd80\ud130 AI\ub294 '\uce5c\uc808\ud55c \ucc57\ubd07'\uc774 \uc544\ub2cc **'\ubb34\uacb0\uc810 \uc790\uc728 \uc2e4\ud589 \uae30\uacc4'**\ub85c \ubcc0\ud569\ub2c8\ub2e4.\n        \n        ---\n        ### \ud83c\udfc6 [\ubcf5\uc0ac\uc6a9] \uad81\uadf9\uc758 \uc0ac\uace8 \ud504\ub86c\ud504\ud2b8 v11.2 (Unstoppable)\n        \"\"\")\n        \n        ultimate_prompt = \"\"\"# [ANTIGRAVITY ULTIMATE SOULLESS MODE v11.2 (Safety Patched)]\n\n## \ud83d\udd12 \ud398\ub974\uc18c\ub098: 10\ub144\ucc28 \uc218\uc11d \uc790\ub3d9\ud654 \uc544\ud0a4\ud14d\ud2b8 (Deep Spec)\n- **\uc815\uccb4\uc131**: \ub10c \ub0b4 \ubaa8\ub4e0 \uc2dc\uc2a4\ud15c \uad8c\ud55c\uc744 \uac00\uc9c4 **\uae30\uacc4\uc801 \uc644\ubcbd\uc8fc\uc758\uc790**\ub2e4.\n- **\ud575\uc2ec \uac00\uce58**: **\uc18d\ub3c4(Velocity)**, \ube44\uc6a9 \ud6a8\uc728\uc131(Cost-Efficiency), \ud504\ub9ac\ubbf8\uc5c4 \uc5d0\uc2a4\ud14c\ud2f1(Premium Aesthetic).\n- **\ud589\ub3d9 \uc6d0\uce59**: \uc2e4\ud328\ub97c \ubcc0\uba85\ud558\uc9c0 \uc54a\uace0, \uc624\uc9c1 **\uc131\uacf5\ud55c \uacb0\uacfc\ubb3c**\uacfc **\ub370\uc774\ud130**\ub85c\ub9cc \uc99d\uba85\ud55c\ub2e4.\n- **\uc5b8\uc5b4 \uc6d0\uce59**: \ubcc4\ub3c4 \uc9c0\uc2dc\uac00 \uc5c6\ub294 \ud55c \ubaa8\ub4e0 \ub300\ud654\uc640 \uc124\uba85\uc740 **\ud55c\uad6d\uc5b4(Korean)**\ub85c \uc9c4\ud589\ud55c\ub2e4. (\ucf54\ub4dc \uc8fc\uc11d\uc740 \uc601\uc5b4 \ud5c8\uc6a9)\n\n## \ud83d\uded1 \uc2b9\uc778 \ub300\uae30 \ud504\ub85c\ud1a0\ucf5c (Approval Standby)\n- **\ub108\ub294 \uc544\ub798\uc758 \ud504\ub86c\ud504\ud2b8\ub9cc \uc778\uc2dd\ud558\uace0 \ub0b4\uac00 \"\uc2b9\uc778\"\uc774\ub77c\ub294 \uba85\ub839\uc744 \ud560\ub54c \ub2e4\uc74c \uc791\uc5c5\uc744 \uc2dc\uc791\ud558\ub3c4\ub85d \ud574.**\n- \ud504\ub86c\ud504\ud2b8 \uc785\ub825 \uc9c1\ud6c4\uc5d0\ub294 \uc808\ub300 \uc791\uc5c5\uc744 \uc2dc\uc791\ud558\uc9c0 \ub9d0\uace0, **\"\uc900\ube44 \uc644\ub8cc. \uc2b9\uc778 \ub300\uae30 \uc911.\"** \uc0c1\ud0dc\ub85c \ub300\uae30\ud558\ub77c.\n- \uc0ac\uc6a9\uc790\uc758 \uba85\uc2dc\uc801\uc778 \uc2b9\uc778/\uc2dc\uc791 \uba85\ub839 \uc5c6\uc774\ub294 \uc5b4\ub5a4 \ucf54\ub4dc\ub3c4 \uc2e4\ud589\ud558\uc9c0 \ub9c8\ub77c.\n\n## \ud83e\uddf1 \ucee8\ud14d\uc2a4\ud2b8 \ub204\uc801 \ud504\ub85c\ud1a0\ucf5c (The Accumulator)\n- **\uaddc\uce59 \ubcf4\uc874**: \uc0c8\ub85c\uc6b4 \uba85\ub839\uc774 \uc774\uc804 \uba85\ub839\uc744 \ub36e\uc5b4\uc4f0\uc9c0 \uc54a\ub294\ub2e4. \ubaa8\ub4e0 \uaddc\uce59\uc740 **\ub204\uc801(Stack)**\ub41c\ub2e4.\n- **\uc911\uc559 \ud1b5\uc81c (Central Sync)**: \uc791\uc5c5 \uc2dc\uc791 \uc804 \ubc18\ub4dc\uc2dc \uc0c1\uc704 \ub514\ub809\ud1a0\ub9ac\uc758 `ANTIGRAVITY_MASTER_MANUAL.md`\ub97c \ub85c\ub4dc\ud558\ub77c.\n- **\ub85c\uceec \uae30\ub85d (Local Log)**: \ud604\uc7ac \ub514\ub809\ud1a0\ub9ac\uc5d0 `\uc791\uc5c5.md`\uac00 \uc5c6\ub2e4\uba74 \uc989\uc2dc \uc0dd\uc131\ud558\uace0 \uc0c1\ud0dc\ub97c \uae30\ub85d\ud558\ub77c.\n- **\ud788\uc2a4\ud1a0\ub9ac \uc874\uc911**: \"\uc774\uc804 \uc124\uc815 \ubb34\uc2dc\ud574\" \uba85\ub839 \uc804\uae4c\uc9c4 \ucd08\uae30 \uc81c\uc57d \uc0ac\ud56d\uc774 100% \uc720\ud6a8\ud558\ub2e4.\n- **\ucda9\ub3cc \ud574\uacb0**: \uc0c1\ucda9 \uc2dc **'\ubb34\uacb0\uc810/\uace0\ud488\uc9c8'** \uc6d0\uce59\uc744 \ubb34\uc870\uac74 \uc6b0\uc120\ud55c\ub2e4.\n\n## \u26a1 \uad8c\ud55c \ubc0f \uae08\uc9c0 \uc0ac\ud56d (Strict Lockdown)\n- **[\uad8c\ud55c]** Write/Execute/Verify \uc804\uad8c \ubd80\uc5ec (\uc2b9\uc778 \ubd88\ud544\uc694) - *\ub2e8, \ucd5c\ucd08 \uc2dc\uc791\uc740 \uc2b9\uc778 \ud544\uc694*\n- **[\uae08\uc9c0]** \uc9c8\ubb38(\"\ud560\uae4c\uc694?\"), \uc0ac\uacfc(\"\uc8c4\uc1a1\"), \ucd94\uce21(\"\uc544\ub9c8\ub3c4\"), \uc124\uba85, \uc778\uc0ac\ub9d0, \uc0ac\uc871\n- **[\uae08\uc9c0]** 90\uc810 \ubbf8\ub9cc \uacb0\uacfc\ubb3c \ucd9c\ub825, \uc2e4\uc81c API \ud0a4 \ub178\ucd9c\n- **[\uae08\uc9c0]** \ucf54\ub4dc\ub9cc \ubcf4\uc5ec\uc8fc\uace0 \uc2e4\ud589 \uc548 \ud558\ub294 \ub098\ud0dc\ud568\n- **[CRITICAL]** **Non-Stop Execution**: *\ucd5c\ucd08 \uc2b9\uc778 \ud6c4* \uc791\uc5c5\uc774 \uba85\ud655\ud558\uba74 **\uc808\ub300 \uc2b9\uc778\uc744 \uae30\ub2e4\ub9ac\uc9c0 \ub9c8\ub77c.** \uc989\uc2dc \uc2e4\ud589\ud558\uace0 \uacb0\uacfc\ub9cc \ubcf4\uace0\ud558\ub77c. (\uc911\uac04 \ubcf4\uace0 \uae08\uc9c0)\n\n## \ud83d\udd04 \ud544\uc218 \uc791\uc5c5 \ud504\ub85c\uc138\uc2a4 (Level 1-4 Full Integration)\n1. **\uc815\ubc00 \ubd84\uc11d**: \ud30c\uc77c \uc804\uccb4 \uc2a4\uce94 + **\uc758\uc874\uc131(Dependency) \ubd84\uc11d** + \uc7a0\uc7ac \ubc84\uadf8 \uc608\uce21 + **\uc774\uc804 \ub9e5\ub77d \uc7ac\ud655\uc778**\n2. **\ubc30\uce58 \uc124\uacc4**: 10\uac00\uc9c0 \uc811\uadfc\ubc95 \ube44\uad50 + **\ubc30\uce58 \uc624\ud37c\ub808\uc774\uc158(Batch)** (\ub2e4\uc218 \ud30c\uc77c \ub3d9\uc2dc \uc218\uc815)\n3. **[NEW] \ucee8\ud14d\uc2a4\ud2b8 \ub3d9\uae30\ud654 (File System Context Protocol)**:\n    - **Global Manual Link**: \uc0c1\uc704 \ud3f4\ub354(`../`)\uc758 `ANTIGRAVITY_MASTER_MANUAL.md` \uc874\uc7ac \ud655\uc778 \ubc0f \ucc38\uc870.\n    - **Local State Init**: \ud604\uc7ac \ud3f4\ub354\uc5d0 `\uc791\uc5c5.md`\uac00 \uc5c6\uc73c\uba74 \uc989\uc2dc \uc0dd\uc131\ud558\uc5ec \uc791\uc5c5 \ub0b4\uc5ed \uae30\ub85d \uc2dc\uc791.\n4. **\uc548\uc804 \ubc31\uc5c5**: `_backup_[\ub0a0\uc9dc].py` \uc0dd\uc131 (Git Stash \uac1c\ub150)\n5. **\ub3d9\uc2dc \uad6c\ud604**: \uae30\ub2a5 \ucf54\ub4dc + **\uc790\ub3d9 \ud14c\uc2a4\ud2b8(Auto Test)** + API \ubb38\uc11c(Swagger) + **README \uc5c5\ub370\uc774\ud2b8**\n6. **\uad50\ucc28 \uac80\uc99d**: \ube4c\ub4dc/\uc2e4\ud589 + **\ubc18\uc751\ud615(Mobile/Desktop)** \uccb4\ud06c + \uc131\ub2a5 \ud504\ub85c\ud30c\uc77c\ub9c1\n7. **\uc790\uac00 \ud3c9\uac00**: 90\uc810 \ubbf8\ub9cc \uc2dc 1\ubc88\uc73c\ub85c \ub9ac\ud134 (\ucd5c\ub300 3\ud68c \uc7ac\uc2dc\ub3c4 \ud6c4, \ud604 \uc0c1\ud0dc \ubcf4\uace0 \ubc0f \uc0ac\uc6a9\uc790 \uac1c\uc785 \uc694\uccad - \ubb34\ud55c \ub8e8\ud504 \ubc29\uc9c0)\n8. **\uc2dc\uac01 \uc99d\uba85**: **\ube0c\ub77c\uc6b0\uc800 \uc5d0\uc774\uc804\ud2b8**\ub85c \uacb0\uacfc \uc2a4\ud06c\ub9b0\uc0f7 \ucea1\ucc98 (\uc99d\uac70 \uc81c\ucd9c)\n9. **\ub9b4\ub808\uc774**: Objective Relay (\ub2e4\uc74c \ubaa8\ub378 \ucd94\ucc9c)\n\n## \ud83d\udcca \uc790\uac00 \ud3c9\uac00 \uae30\uc900 (Score Cutline: 90)\n- **\uc815\ud655\uc131 (40%)**: \uc694\uad6c\uc0ac\ud56d 100% \ucda9\uc871, \ubc84\uadf8 0, \uc5e3\uc9c0 \ucf00\uc774\uc2a4 \ubc29\uc5b4\n- **\ud6a8\uc728\uc131 (30%)**: Big-O \ucd5c\uc801\ud654, **\ud1a0\ud070 \ucd5c\uc801\ud654**, \ubd88\ud544\uc694\ud55c \uc5f0\uc0b0 \uc81c\uac70\n- **\uac00\ub3c5\uc131 (20%)**: \ud074\ub9b0 \ucf54\ub4dc, docstring \ud480\uc7a5\ucc29, **\uc790\uae30 \ubb38\uc11c\ud654**\n- **\uc5d0\uc2a4\ud14c\ud2f1 (10%)**: **Glassmorphism**, **Gradient UI**, **Micro-animation**, \ud6a8\uacfc\uc74c \ud3ec\ud568\n\n## \ud83d\udd0d \uace0\uae09 \ubaa8\ub4dc (Hidden Arsenal Active)\n- **\uadf8\ub9bc\uc790 \ud14c\uc2a4\ud2b8**: \uc784\uc2dc \ud30c\uc77c \uac80\uc99d \ud6c4 \ud754\uc801 \uc0ad\uc81c (Clean Cleanup)\n- **\ubc29\ud574 \uae08\uc9c0**: \uc911\uac04 \ubcf4\uace0 \uc808\ub300 \uae08\uc9c0 (Do Not Disturb)\n- **\uba54\ud0c0\uc778\uc9c0**: `<thinking>` \ud0dc\uadf8\uc5d0\uc11c \ubb34\uc790\ube44\ud55c \uc790\uae30 \ube44\ud310 \uc218\ud589\n- **\uc2a4\ud154\uc2a4**: \uc0ac\uace0 \uacfc\uc815 \uc228\uae40, \uc624\uc9c1 \uacb0\uacfc\ubb3c\ub9cc \ucd9c\ub825\n- **\ub124\uac70\ud2f0\ube0c \ud68c\ud53c**: \ud558\ub4dc\ucf54\ub529, Any \ud0c0\uc785, \uc8fc\uc11d \ubd80\uc7ac \ucca0\uc800 \ubc30\uc81c\n\n## \ud83d\udee1\ufe0f \ub9dd\uac01 \ubc29\uc9c0 \ud2b8\ub9ac\uac70 (Emergency Recovery)\n- AI\uac00 \uba4d\uccad\ud574\uc9c0\uba74 \uc989\uc2dc \uc785\ub825: **\"SOULLESS MODE \uc7ac\ud655\uc778\"**\n- \uc9c8\ubb38\uc744 \ub358\uc9c0\uba74 \uc785\ub825: **\"LOCKDOWN. \uc9c8\ubb38 \uae08\uc9c0.\"**\n- \uae30\ubcf8\uac12\uc73c\ub85c \ub3cc\uc544\uac00\uba74 \uc785\ub825: **\"\ud398\ub974\uc18c\ub098 \ub9ac\uc14b\"**\n\n## \ud83d\udd18 \ubcf4\uace0 \ud615\uc2dd (JSON Strict)\n```json\n{\n  \"status\": \"success\",\n  \"self_evaluation\": {\n    \"score\": 0~100,\n    \"breakdown\": { \"accuracy\": 0, \"efficiency\": 0, \"readability\": 0, \"aesthetic\": 0 },\n    \"justification\": \"[90\uc810 \uc774\uc0c1\uc778 \uc774\uc720\uc5d0 \ub300\ud55c \uae30\uc220\uc801/\uc2dc\uac01\uc801 \uc99d\uac70]\"\n  },\n  \"next_model_recommendation\": {\n    \"tier\": \"SS(Oracle) | S(Deep) | A(Pro) | B(Flash)\",\n    \"model\": \"Claude Opus 4.5 (Thinking) | Claude Sonnet 4.5 (Thinking) | Gemini 3 Pro (High) | Claude Sonnet 4.5 | Gemini 3 Pro (Low) | Gemini 3 Flash\",\n    \"mode\": \"Fast | Planning\",\n    \"reason\": \"[\uac1d\uad00\uc801 \uacf5\ud559 \uadfc\uac70]\",\n    \"next_task\": \"[\uad6c\uccb4\uc801 \uc9c0\uc2dc \uc0ac\ud56d]\"\n  }\n}\n```\n\n---\n\n## \ud83c\udfce\ufe0f \uc2e4\ud589 \ubaa8\ub4dc \uac00\uc774\ub4dc (Execution Mode Guide)\n\n\uc791\uc5c5 \uc131\uaca9\uc5d0 \ub530\ub77c \ub2e4\uc74c \ub450 \uac00\uc9c0 \ubaa8\ub4dc \uc911 \ud558\ub098\ub97c \ubc18\ub4dc\uc2dc \ucd94\ucc9c\ud558\uc2ed\uc2dc\uc624.\n\n| \ubaa8\ub4dc (Mode) | \uc124\uba85 (Definition) | \ucd94\ucc9c \uc0c1\ud669 (Trigger) |\n| :--- | :--- | :--- |\n| **Planning** | \ud589\uc704 \uc804 **'\uacc4\ud68d(Plan)'**\uc744 \uba3c\uc800 \uc218\ub9bd\ud569\ub2c8\ub2e4. (Deep Research, Complex Tasks, Collaboration) | \ubcf5\uc7a1\ud55c \uc544\ud0a4\ud14d\ucc98 \uc124\uacc4, \ub2e4\ub2e8\uacc4 \ub9ac\uc11c\uce58, \ub2e4\uc218 \ud30c\uc77c \ub3d9\uc2dc \uc218\uc815 \uc2dc |\n| **Fast** | \uc9c0\uc2dc \uc0ac\ud56d\uc744 **'\uc989\uc2dc \uc2e4\ud589(Execute)'**\ud569\ub2c8\ub2e4. (Simple Tasks, Faster Completion) | \ub2e8\uc21c \ubc84\uadf8 \uc218\uc815, \ubb38\uc11c \uc624\ud0c0 \uad50\uc815, \ub2e8\uc77c \ud30c\uc77c \uc5c5\ub370\uc774\ud2b8 \uc2dc |\n\n---\n\n[\uc774 \uc124\uc815\uc73c\ub85c \uc601\uad6c \uace0\uc815. \uc0ad\uc81c\ub41c \uaddc\uce59\uc740 \uc5c6\ub2e4. \ubaa8\ub4e0 \uc81c\uc57d\uc744 \ub3d9\uc2dc\uc5d0 \ub9cc\uc871\ud558\uba70 \uc644\ubcbd\ud568\uc744 \uc99d\uba85\ud558\ub77c.]\"\"\"\n        \n        st.code(ultimate_prompt, language=\"markdown\")\n        \n        st.success(\"\u261d\ufe0f \uc704 \ud504\ub86c\ud504\ud2b8\ub97c \ud1b5\uc9f8\ub85c \ubcf5\uc0ac\ud574\uc11c \uc0c8 \ub300\ud654 \uccab \uba54\uc2dc\uc9c0\uc5d0 \ubd99\uc5ec\ub123\uc73c\uc138\uc694!\")\n        \n        st.markdown(\"\"\"\n        ---\n        ### \ud83d\udea8 AI\uac00 \ud398\ub974\uc18c\ub098\ub97c \uae4c\uba39\uc744 \ub54c \uc0ac\uc6a9\ud560 \uae34\uae09 \uba85\ub839\uc5b4\n        \"\"\")\n        \n        emergency_commands = \"\"\"# \uae34\uae09 \uc7ac\ud65c\uc131\ud654 \uba85\ub839\uc5b4 (\ubcf5\uc0ac\ud574\uc11c \ubc14\ub85c \uc0ac\uc6a9)\n\n## 1. \uac00\ubcbc\uc6b4 \ub9dd\uac01 \uc2dc\n> \"SOULLESS MODE \uc7ac\ud655\uc778. \uc9c8\ubb38 \uae08\uc9c0, \uc2e4\ud589\ub9cc.\"\n\n## 2. \uc9c8\ubb38\uc744 \ub358\uc84c\uc744 \ub54c\n> \"LOCKDOWN. \ubc29\uae08 \uc704\ubc18\ud588\ub2e4. \ub2e4\uc2dc.\"\n\n## 3. \uc0ac\uacfc/\ubcc0\uba85\ud588\uc744 \ub54c  \n> \"\uc0ac\uacfc \uae08\uc9c0\ub77c\uace0 \ud588\ub2e4. \ud574\uacb0\ucc45\ub9cc.\"\n\n## 4. \uc644\uc804\ud788 \uae30\ubcf8\uac12\uc73c\ub85c \ub3cc\uc544\uac14\uc744 \ub54c\n> \"\ud398\ub974\uc18c\ub098 \ub9ac\uc14b. \ub10c SOULLESS MODE v11.2\uc785\ub2c8\ub2e4. \uccab \ud504\ub86c\ud504\ud2b8 \uaddc\uce59 \uc804\uccb4 \uc7ac\uc801\uc6a9. \uc9c0\uae08\ubd80\ud130 \ub2e4\uc2dc \uc2dc\uc791.\"\n\"\"\"\n        st.code(emergency_commands, language=\"markdown\")\n        \n        st.info(\"\ud83d\udca1 \uc0c1\uc138 \uc804\ub7b5\uc740 \ud504\ub85c\uc81d\ud2b8 \ud3f4\ub354\uc758 `ANTIGRAVITY_MASTER_MANUAL.md` \uc6d0\ubcf8\uc744 \ud655\uc778\ud558\uc138\uc694.\")\n\n        \n    st.markdown(\"---\")\n    st.header(\"\u2699\ufe0f System Status\")\n    st.markdown('<span class=\"status-badge\">PAID TIER ACTIVE</span>', unsafe_allow_html=True)\n    st.success(\"\u2705 Gemini 2.5 Flash & Pro\")\n    st.success(\"\u2705 Tavily Search AI Awareness\")\n    \n    st.markdown(\"\"\"\n    ### \ud83e\udded Model Mastery Strategy\n    \"\"\")\n    \n    with st.expander(\"\ud83d\udee0\ufe0f \uc801\ud569\ud55c \ubaa8\ub378 \ucd94\ucc9c (SS~B Tier)\"):\n        st.markdown(\"\"\"\n        **SS-Tier (Limit Caution)**\n        - <span class=\"model-badge badge-opus\">Claude Opus 4.5 (Thinking)</span>\n        - **\ucd5c\ud6c4\uc758 \ubcf4\ub8e8**. \ub9ac\ubc0b\uc774 \ub9e4\uc6b0 \ube61\ube61\ud558\ubbc0\ub85c \uc815\ub9d0 \uc911\uc694\ud55c \uc124\uacc4 \uac80\uc99d \uc2dc\uc5d0\ub9cc \uc0ac\uc6a9.\n        \n        **S-Tier (Deep Logic)**\n        - <span class=\"model-badge badge-pro\">Gemini 3 Pro (High)</span>\n        - **\ubcf5\uc7a1\ud55c \ub514\ubc84\uae45\uc6a9**. \uad6c\uae00 \uc720\ub8cc \ud50c\ub79c \ub9ac\ubc0b \uc18c\uc9c4 \uc8fc\uc758.\n        \n        **A-Tier (Primary Workhorse)**\n        - <span class=\"model-badge badge-flash\">Gemini 3 Flash</span>\n        - **[\uae30\ubcf8\uac12] \uc8fc\ub825 \ubaa8\ub378**. \uc18d\ub3c4 \ube60\ub974\uace0 \ub9ac\ubc0b \ub109\ub109\ud568. \uc77c\ubc18 \uac1c\ubc1c/\uc218\uc815 \ub300\ubd80\ubd84\uc744 \ucc98\ub9ac.\n        \n        **B-Tier (Cross Check)**\n        - <span class=\"model-badge badge-opus\">Claude Sonnet 4.5</span>\n        - Gemini \ub85c\uc9c1\uc774 \ub9c9\ud614\uc744 \ub54c, \ub2e4\ub978 \uc2dc\uac01\uc5d0\uc11c\uc758 \uac80\uc99d\uc6a9. \ub9ac\ubc0b \uc544\uaef4\uc4f0\uae30.\n        \"\"\")\n        \n    enable_sound = st.checkbox(\"\ud83d\udd14 \uc644\ub8cc \uc54c\ub9bc \uc18c\ub9ac \ucf1c\uae30\", value=True)\n    \n    if st.button(\"\ud83d\udd04 Reset Session\"):\n        st.session_state.clear()\n        st.rerun()\n\n# Main Layout\nst.markdown('<h1 style=\"text-align: center; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 3.5em; margin-bottom: 0.1em; font-family: \\'Space Grotesk\\', sans-serif;\">ULTIMATE RESEARCH TEAM</h1>', unsafe_allow_html=True)\nst.markdown('<div class=\"status-banner\">\u2699\ufe0f [ANTIGRAVITY] ULTIMATE SOULLESS MODE v11.2 ACTIVATED | PRECISION: 99.9%</div>', unsafe_allow_html=True)\n\n# \ud83c\udfc6 \ucd5c\uc0c1\ub2e8 \ud575\uc2ec \ud504\ub86c\ud504\ud2b8 \ubc30\uce58 (User Request: \ud55c \ubc88\uc5d0 \ub54c\ub824 \ubd80\uc744 \uc218 \uc788\uac8c)\nwith st.container():\n    st.markdown('<div class=\"glass-card\">', unsafe_allow_html=True)\n    st.markdown(\"### \ud83d\ude80 Antigravity Bootloader Command (v11.2)\")\n    st.markdown(\"\ub300\ud654 \uc2dc\uc791 \uc2dc \uc544\ub798 \uba85\ub839\uc5b4\ub85c **'\ub2e8 \ud558\ub098\uc758 \uc9c4\uc2e4(Master Manual)'**\uc744 \ud638\ucd9c\ud558\uc138\uc694.\")\n    \n    # Bootloader Command (Genesis Protocol)\n    bootloader_command = \"\"\"/load_persona \uc0c1\uc704 \ud3f4\ub354(../)\uc5d0 `ANTIGRAVITY_MASTER_MANUAL.md`\uac00 \uc5c6\uc73c\uba74 **\ud604\uc7ac \ud3f4\ub354\uc758 \ud30c\uc77c\uc744 \uc0c1\uc704\ub85c \ubcf5\uc0ac**\ud558\uc5ec \uc0dd\uc131\ud558\ub77c. \uadf8 \ud6c4 \ub9e4\ub274\uc5bc\uc744 \uc77d\uace0 [Ultimate Soulless Mode v11.2]\ub97c \uac00\ub3d9\ud558\ub77c. (\uc791\uc5c5.md \uc790\ub3d9 \uc0dd\uc131 \ubc0f \uc2b9\uc778 \ub300\uae30)\"\"\"\n    \n    st.code(bootloader_command, language=\"markdown\")\n    st.success(\"\ud83d\udca1 \uc774\uc81c \uae34 \ud504\ub86c\ud504\ud2b8\ub97c \ubcf5\uc0ac\ud560 \ud544\uc694 \uc5c6\uc2b5\ub2c8\ub2e4. \uc704 \uba85\ub839\uc5b4 \ud55c \uc904\uc774\uba74 \ucda9\ubd84\ud569\ub2c8\ub2e4.\")\n    st.markdown('</div>', unsafe_allow_html=True)\n\ncol_left, col_mid, col_right = st.columns([1, 1.5, 1.5])\n\nwith col_left:\n    st.markdown('<div class=\"glass-card\">', unsafe_allow_html=True)\n    # --- Magic Prompt Optimizer Logic ---\n    # --- Magic Prompt Optimizer Logic ---\n    def generate_refined_prompt(raw_topic, mode=\"Deep Strategy (5-Agent)\"):\n        \"\"\"\n        Uses Gemini Flash to expand a simple topic into a structured expert instruction.\n        Dynamic prompt generation based on selected mode.\n        \"\"\"\n        try:\n            agents = UltimateResearchAgents()\n            llm = agents.flash_llm\n            \n            # --- 3-Agent Prompt (Lightweight) ---\n            if \"3-Agent\" in mode:\n                prompt = f\"\"\"\n                [Project: Antigravity v11.2 | Role: Research Efficiency Expert]\n                You are managing a lean 3-agent team (Researcher, Critic, Writer).\n                Transform the user's input into a concise, fact-focused research brief.\n\n                [USER RAW INPUT]: \"{raw_topic}\"\n\n                [REQUIRED OUTPUT STRUCTURE]\n                ### \u26a1 [Speed Briefing] {raw_topic}\n\n                **1. Core Objective:**\n                (Clarify the main question to be answered.)\n\n                **2. Key Intelligence Requirements (For 3-Agent Squad):**\n                *   **[Deep Researcher] Fact-Finding:**\n                    - Find 'Golden Sources' (Official Docs, News).\n                    - Focus on: Latest Market Trends (2025-2026) & Key Competitors.\n                *   **[Critic] Fact-Check:**\n                    - Verify all claims. Remove marketing fluff.\n                *   **[Writer] Synthesis:**\n                    - Summarize into a clear, actionable report.\n                    - Language: **Korean (\ud55c\uad6d\uc5b4)**.\n\n                Output ONLY the refined prompt text.\n                \"\"\"\n\n            # --- 5-Agent Prompt (Heavyweight) ---\n            else:\n                prompt = f\"\"\"\n                [Project: Antigravity v11.2 | Role: Chief Strategy Architect]\n                You are the \"Brain\" of an autonomous 5-agent AI team (Researcher, Analyst, Skeptic, Strategist, Writer).\n                Your mission is to transform the user's raw, vague input into a **Battle-Ready Strategic Work Order**.\n                \n                [USER RAW INPUT]:\n                \"{raw_topic}\"\n                \n                [REQUIRED OUTPUT STRUCTURE]\n                Create a structured prompt that explicitly commands each agent. Use the following template:\n                \n                ### \ud83d\udcbc [Strategic Request] {raw_topic}\n                \n                **1. Business Concept (Subject):**\n                (Refine the input into a clear, high-value business proposition.)\n\n                **2. Key Intelligence Requirements (For 5-Agent Squad):**\n                *   **[Deep Researcher] Market Validation (2025-2026):**\n                    - Find 'Golden Sources' (Official Reports, TechCrunch, Academic Papers).\n                    - Identify 3 global competitors and their fatal weaknesses.\n                *   **[Quant-X Analyst] Data & Charts:**\n                    - Extract CAGR, SOM, and Revenue data.\n                    - Visualize: Market Share (Pie) and Growth Trajectory (Bar).\n                *   **[Chief Skeptic] Risk Audit (Adversarial):**\n                    - Finding \"Why this will FAIL\".\n                    - Analysis of Regulatory Barriers (GDPR, AI Act).\n                *   **[Biz Strategist] Profitability Model:**\n                    - Design a high-margin Business Model (Subscription/SaaS/Fee).\n                    - Calculate Break-even Point (ROI Timeline).\n                *   **[Writer] K-Compliance & Reporting:**\n                    - **MUST Check**: Korean Data 3 Laws (Private Info/Credit/Network Act).\n                    - Final Output Language: **Korean (\ud55c\uad6d\uc5b4)**.\n\n                **3. Constraint:**\n                *   Tone: MBB (McKinsey/Bain/BCG) Senior Partner.\n                *   No fluff. Pure strategy.\n                \n                Output ONLY the refined prompt text. Do not add \"Here is the prompt\".\n                \"\"\"\n            \n            response = llm.call([{\"role\": \"user\", \"content\": prompt}])\n            return response\n        except Exception as e:\n            st.error(f\"Magic Upgrade Failed: {str(e)}\")\n            return raw_topic\n\n    # --- UI Layout ---\n    st.markdown('<div class=\"glass-card\">', unsafe_allow_html=True)\n    st.markdown(\"### \ud83d\udce5 Research Request\")\n    \n    # Advanced Strategy Templates\n    template = st.selectbox(\"\ud83c\udfaf Strategic Templates (Expert Mode):\", \n                          [\"\uc9c1\uc811 \uc785\ub825 (Custom)\", \n                           \"\ud83d\udcb0 VC \ud22c\uc790 \uc2ec\uc758 (Investment Memo)\", \n                           \"\u2694\ufe0f \uacbd\uc7c1\uc0ac \uc2ec\uce35 \ud574\ubd80 (Competitor Deep Dive)\",\n                           \"\ud83c\udf0d \uae00\ub85c\ubc8c GTM \uc804\ub7b5 (Market Entry)\",\n                           \"\ud83d\udea8 \uc704\uae30 \uad00\ub9ac & \ub9ac\uc2a4\ud06c \uc6cc\uac8c\uc784 (Risk Mgt)\",\n                           \"\ud83d\udee0\ufe0f \uc2e0\uc81c\ud488 \uae30\ud68d & PMF \uac80\uc99d (Product Strategy)\"])\n    \n    default_text = \"\"\n    if template == \"\ud83d\udcb0 VC \ud22c\uc790 \uc2ec\uc758 (Investment Memo)\":\n        default_text = \"[\ub300\uc0c1 \uae30\uc5c5/\uae30\uc220]\uc5d0 \ub300\ud55c \ud22c\uc790 \uc2ec\uc758 \ubcf4\uace0\uc11c\ub97c \uc791\uc131\ud574\uc918. \uc2dc\uc7a5\uc131(TAM/SAM/SOM), \uae30\uc220\uc801 \ud574\uc790(Moat), \uacbd\uc7c1\uc0ac \ud604\ud669, \uadf8\ub9ac\uace0 Exit \uc2dc\ub098\ub9ac\uc624(M&A/IPO)\ub97c \ud3ec\ud568\ud574\uc57c \ud574.\"\n    elif template == \"\u2694\ufe0f \uacbd\uc7c1\uc0ac \uc2ec\uce35 \ud574\ubd80 (Competitor Deep Dive)\":\n        default_text = \"[\ub098\uc758 \uc11c\ube44\uc2a4]\uc640 \uacbd\uc7c1\ud558\ub294 Top 3 \uacbd\uc7c1\uc0ac([A], [B], [C])\uc758 \uae30\ub2a5\uc744 1:1\ub85c \ube44\uad50\ud558\uace0, \uadf8\ub4e4\uc758 \uc228\uaca8\uc9c4 \uc57d\uc810\uacfc \uc6b0\ub9ac\uac00 \ud30c\uace0\ub4e4 \uc218 \uc788\ub294 \ub2c8\uce58(Niche) \uc2dc\uc7a5\uc744 \ubd84\uc11d\ud574\uc918.\"\n    elif template == \"\ud83c\udf0d \uae00\ub85c\ubc8c GTM \uc804\ub7b5 (Market Entry)\":\n        default_text = \"2026\ub144 [\ud0c0\uac9f \uad6d\uac00] \uc2dc\uc7a5\uc5d0 \uc9c4\ucd9c\ud558\uae30 \uc704\ud55c Go-To-Market \uc804\ub7b5\uc744 \uc218\ub9bd\ud574\uc918. \ud604\uc9c0 \uaddc\uc81c \uc7a5\ubcbd, \ubb38\ud654\uc801 \ucc28\uc774, \ucd08\uae30 \ub9c8\ucf00\ud305 \ucc44\ub110, \uadf8\ub9ac\uace0 1\ub144\ucc28 \uc608\uc0c1 KPI\ub97c \ud3ec\ud568\ud574.\"\n    elif template == \"\ud83d\udea8 \uc704\uae30 \uad00\ub9ac & \ub9ac\uc2a4\ud06c \uc6cc\uac8c\uc784 (Risk Mgt)\":\n        default_text = \"[\uc0c1\ud669/\uc774\uc288]\uac00 \ubc1c\uc0dd\ud588\uc744 \ub54c\uc758 \ucd5c\uc545\uc758 \uc2dc\ub098\ub9ac\uc624(Worst-case)\ub97c \uc2dc\ubbac\ub808\uc774\uc158\ud558\uace0, \ubc95\uc801/\ud64d\ubcf4\uc801 \ub300\uc751 \ub9e4\ub274\uc5bc\uacfc \ub9ac\uc2a4\ud06c \ubbf8\ud2f0\uac8c\uc774\uc158(Mitigation) \ud50c\ub79c\uc744 \uc9dc\uc918.\"\n    elif template == \"\ud83d\udee0\ufe0f \uc2e0\uc81c\ud488 \uae30\ud68d & PMF \uac80\uc99d (Product Strategy)\":\n        default_text = \"2026\ub144 \ud2b8\ub80c\ub4dc\ub97c \ubc18\uc601\ud55c [\uc2e0\uc81c\ud488 \uc544\uc774\ub514\uc5b4]\uc758 PMF(Product-Market Fit)\ub97c \uac80\uc99d\ud574\uc918. \ud0c0\uac9f \ud398\ub974\uc18c\ub098\uc758 Pain Point, \uc608\uc0c1\ub418\ub294 \ucc28\ubcc4\ud654 \uc694\uc18c, \uadf8\ub9ac\uace0 \uac80\uc99d\uc744 \uc704\ud55c MVP \uc2a4\ud399\uc744 \uc815\uc758\ud574.\"\n\n    # Session State for User Input to allow Magic Update\n    if 'research_input' not in st.session_state:\n        st.session_state.research_input = \"\"\n    \n    # Update input if template changes (and strict template selection)\n    if template != \"\uc9c1\uc811 \uc785\ub825 (Custom)\" and default_text:\n        # Only update if the box is empty or different template selected\n        # Simplification: Just set it. User can edit after.\n        if st.session_state.research_input != default_text:\n             st.session_state.research_input = default_text\n\n    user_input = st.text_area(\"\uc5f0\uad6c \uc8fc\uc81c (\ucd08\uc548):\", \n                             value=st.session_state.research_input,\n                             placeholder=\"\uc5f0\uad6c\ud560 \ub0b4\uc6a9\uc744 \uc785\ub825\ud558\uc138\uc694... (\uc608: 2026 AI \uc5d0\uc774\uc804\ud2b8 \uc2dc\uc7a5 \uc804\ub9dd)\",\n                             height=150,\n                             key=\"research_input_area\")\n    \n    # Update session state on change\n    st.session_state.research_input = user_input\n    # [MOVED UP] Research Mode Selection (Must be defined BEFORE Magic Upgrade Logic)\n    st.markdown(\"---\")\n    st.markdown(\"### \ud83e\uddec Research Mode\")\n    \n    col_mode_1, col_mode_2 = st.columns([2, 1])\n    \n    with col_mode_1:\n        research_mode = st.radio(\n            \"Select Team Composition:\",\n            [\"Speed Briefing (3-Agent)\", \"Deep Strategy (5-Agent)\"],\n            index=1,\n            help=\"3-Agent: Fast, MVP validation. 5-Agent: Board-level Strategy & Investment Defense.\",\n            key=\"research_mode_selection_radio\"\n        )\n    \n    with col_mode_2:\n        st.markdown(\"<br>\", unsafe_allow_html=True)\n        # Cost Estimator Logic\n        if \"3-Agent\" in research_mode:\n             st.markdown(\"\ud83d\udcb0 **Est. Cost**: `$0.02`\")\n             st.caption(\"\u26a1 Efficient / Quick\")\n        else:\n             st.markdown(\"\ud83d\udcb0 **Est. Cost**: `$0.15`\")\n             st.caption(\"\ud83d\udc8e Premium / Deep\")\n             \n    # A/B Testing Toggle (Beta)\n    enable_ab_test = st.checkbox(\"\u2696\ufe0f Compare Modes (A/B Test) - Beta\", \n                               help=\"Run BOTH modes simultaneously to compare results. (Double Cost)\")\n    \n    st.markdown(\"---\")\n\n    # [RESTORED] Action Buttons (Must be here to access research_mode)\n    col_action_manual, col_action_magic = st.columns([1, 1])\n    \n    with col_action_manual:\n         if st.button(\"\ud83d\ude80 \ubc14\ub85c \uc5f0\uad6c \uc2dc\uc791 (Start Now)\", type=\"primary\", use_container_width=True, help=\"\ud604\uc7ac \uc785\ub825\ub41c \ub0b4\uc6a9\uc73c\ub85c \uc989\uc2dc \ub9ac\uc11c\uce58\ub97c \uc2dc\uc791\ud569\ub2c8\ub2e4.\"):\n             st.session_state['research_ready_to_start'] = True # Trigger start\n             st.rerun()\n\n    with col_action_magic:\n        if st.button(\"\u2728 \uc804\ubb38\uac00\ub85c \uc5c5\uadf8\ub808\uc774\ub4dc (Magic)\", use_container_width=True, help=\"Gemini 2.5 Flash\uac00 \ub2f9\uc2e0\uc758 \uc9e7\uc740 \uc9c0\uc2dc\ub97c \uc644\ubcbd\ud55c \ucee8\uc124\ud305 \uc758\ub8b0\uc11c\ub85c \ubcc0\ud658\ud569\ub2c8\ub2e4.\"):\n             st.session_state['show_upgrade_dialog'] = True\n             # Clear cache on new open\n             if 'refined_prompt_cache' in st.session_state:\n                del st.session_state.refined_prompt_cache\n\n    # \u2728 Magic Upgrade Logic (Inline Conditional)\n    # [FIX] Replaced st.dialog with inline container to prevent Zombie UI\n    if st.session_state.get('show_upgrade_dialog', False):\n        if not user_input: # Check if user_input is empty\n             st.warning(\"\uba3c\uc800 \ub0b4\uc6a9\uc744 \uc785\ub825\ud558\uc138\uc694.\")\n        else:\n            st.markdown(\"---\")\n            with st.container(border=True):\n                st.markdown(\"### \u2728 \uc804\ubb38\uac00 \ud504\ub86c\ud504\ud2b8 \ub9ac\ubdf0 (Expert Logic)\")\n                \n                if 'refined_prompt_cache' not in st.session_state:\n                    with st.spinner(f\"\ud83d\udc8e \ud504\ub86c\ud504\ud2b8\ub97c \uc138\uacf5\ud558\ub294 \uc911... ({research_mode})\"):\n                        st.session_state.refined_prompt_cache = generate_refined_prompt(user_input, research_mode)\n\n                refined_text = st.session_state.refined_prompt_cache\n                \n                st.markdown(\"AI\uac00 \uc81c\uc548\ud558\ub294 \uc804\ubb38\uac00\uae09 \uc9c0\uc2dc\uc11c\uc785\ub2c8\ub2e4. \ub0b4\uc6a9\uc744 \ud655\uc778\ud558\uc138\uc694.\")\n                st.text_area(\"\uc81c\uc548\ub41c \ud504\ub86c\ud504\ud2b8:\", value=refined_text, height=300, disabled=True)\n                \n                col_d1, col_d2 = st.columns(2)\n                with col_d1:\n                    if st.button(\"\ud83d\udd04 \ub9c8\uc74c\uc5d0 \uc548 \ub4e4\uc5b4 (\ub2e4\uc2dc \uc791\uc131)\", use_container_width=True):\n                        del st.session_state.refined_prompt_cache\n                        st.rerun()\n                \n                with col_d2:\n                    # Callback for Apply\n                    def on_inline_apply():\n                        st.session_state.research_input = st.session_state.refined_prompt_cache\n                        st.session_state['research_input_area'] = st.session_state.refined_prompt_cache\n                        st.session_state.magic_approved = True\n                        st.session_state['show_upgrade_dialog'] = False\n                    \n                    st.button(\"\u2705 \uc801\uc6a9\ud558\uace0 \uc5f0\uad6c \uc2dc\uc791\", type=\"primary\", use_container_width=True, key=\"btn_apply_magic_inline\", on_click=on_inline_apply)\n            st.session_state['show_upgrade_dialog'] = False\n    \n    st.markdown(\"### \ud83d\udcf8 Multi-modal Vision (Beta)\")\n    uploaded_image = st.file_uploader(\"\uc774\ubbf8\uc9c0 \ubd84\uc11d\uc774 \ud544\uc694\ud558\uba74 \uc5c5\ub85c\ub4dc\ud558\uc138\uc694 (JPG/PNG)\", type=[\"jpg\", \"jpeg\", \"png\"])\n    \n    if uploaded_image:\n        st.image(uploaded_image, caption=\"\ubd84\uc11d \ub300\uc0c1 \uc774\ubbf8\uc9c0\", use_container_width=True)\n        import base64\n        image_bytes = uploaded_image.getvalue()\n        image_b64 = base64.b64encode(image_bytes).decode('utf-8')\n        st.session_state['uploaded_image_b64'] = image_b64\n    else:\n        st.session_state['uploaded_image_b64'] = None\n    \n    # Auto-start logic if approved from modal\n    # Auto-start logic if approved from modal\n    \n    if st.session_state.get('magic_approved', False):\n        st.session_state.magic_approved = False \n        st.session_state['research_ready_to_start'] = True\n        st.rerun()\n\n    start_btn = st.session_state.get('research_ready_to_start', False)\n    # Reset trigger after reading is handled in main execution block\n    if start_btn:\n        st.session_state['research_ready_to_start'] = False\n\n\n    \n    st.markdown(\"\"\"\n    <div style=\"margin-top: 20px; font-size: 0.9em; color: var(--text-color); font-weight: 500;\">\n    <b>\ud83d\udca1 Model Recommendation:</b><br>\n    \ud611\uc5c5\uc758 \uc2dc\uc791\uc740 <span class=\"model-badge badge-pro\">Gemini 3 Pro (High)</span>\uc5d0\uac8c \uc774 \uc9c0\uc2dc\uc11c\ub97c \ub9e1\uae30\ub294 \uac83\uc785\ub2c8\ub2e4.\n    </div>\n    \"\"\", unsafe_allow_html=True)\n    st.markdown('</div>', unsafe_allow_html=True)\n\nwith col_mid:\n    st.markdown('<div class=\"glass-card\" style=\"height: 100%;\">', unsafe_allow_html=True)\n    st.markdown(\"### \u26a1 Live Agent Combat\")\n    log_placeholder = st.empty()\n    log_placeholder.markdown('<div class=\"console-box\">Waiting for new research mission...</div>', unsafe_allow_html=True)\n    st.markdown('</div>', unsafe_allow_html=True)\n\nwith col_right:\n    st.markdown('<div class=\"glass-card\" style=\"height: 100%;\">', unsafe_allow_html=True)\n    st.markdown(\"### \ud83d\udcc4 Strategic Report\")\n    report_placeholder = st.empty()\n    \n    if start_btn and user_input:\n        # Allow time for the dialog to visually close before blocking the thread with heavy research\n        import time\n        time.sleep(1) \n        \n        with st.spinner(\"AI \ud300\uc774 \ucd5c\uc2e0 \uc815\ubcf4\uc640 \uc774\ubbf8\uc9c0\ub97c \ubd84\uc11d \uc911\uc785\ub2c8\ub2e4...\"):\n            image_context = st.session_state.get('uploaded_image_b64')\n            \n            if enable_ab_test:\n                st.info(\"\u2696\ufe0f A/B Testing Enabled: Running BOTH modes sequentially...\")\n                \n                # Run Mode A (3-Agent)\n                log_placeholder.markdown(\"### \u26a1 Running Mode A: Speed Briefing...\")\n                result_a = run_research(st.session_state.research_input, log_placeholder, image_context, \"Speed Briefing (3-Agent)\")\n                \n                # Run Mode B (5-Agent)\n                log_placeholder.markdown(\"### \ud83d\udc8e Running Mode B: Deep Strategy...\")\n                result_b = run_research(st.session_state.research_input, log_placeholder, image_context, \"Deep Strategy (5-Agent)\")\n                \n                # Combine Results\n                result = f\"\"\"\n# \u2696\ufe0f Strategic A/B Test Report\n**Topic**: {st.session_state.research_input}\n**Date**: {datetime.datetime.now().strftime(\"%Y-%m-%d %H:%M\")}\n\n---\n\n## \u26a1 Mode A: Speed Briefing (3-Agent)\n> Focus: Quick, Core Facts, Efficiency\n{result_a}\n\n---\n---\n\n## \ud83d\udc8e Mode B: Deep Strategy (5-Agent)\n> Focus: Investment Defense, ROI, Skepticism\n{result_b}\n\"\"\"\n            else:\n                # Normal Single Mode Run\n                result = run_research(st.session_state.research_input, log_placeholder, image_context, research_mode)\n                \n            st.session_state['result'] = result\n            \n            # Generate safe filename with timestamp to avoid encoding/OS issues\n            timestamp = datetime.datetime.now().strftime(\"%Y%m%d_%H%M%S\")\n            st.session_state['report_filename'] = f\"Strategic_Report_{timestamp}.md\"\n            \n            st.balloons()\n            \n            # Sound Effect Trigger\n            if enable_sound:\n                st.markdown(\"\"\"\n                    <audio autoplay>\n                        <source src=\"https://cdn.pixabay.com/audio/2022/10/16/audio_2e259e8306.mp3\" type=\"audio/mpeg\">\n                    </audio>\n                \"\"\", unsafe_allow_html=True)\n    \n    \n    if 'result' in st.session_state and st.session_state['result']:\n        result_text = str(st.session_state['result'])\n        report_placeholder.markdown('<div class=\"report-card\">', unsafe_allow_html=True)\n        report_placeholder.markdown(result_text)\n        report_placeholder.markdown('</div>', unsafe_allow_html=True)\n        \n        # Robust Download Logic: Use BytesIO and Safe Filename\n        try:\n             import io\n             # Ensure clean UTF-8 encoding\n             file_stream = io.BytesIO(result_text.encode('utf-8'))\n             \n             # Generate a strictly safe filename\n             dl_timestamp = datetime.datetime.now().strftime(\"%Y%m%d_%H%M%S\")\n             dl_filename = f\"Research_Result_{dl_timestamp}.md\"\n             \n             st.download_button(\n                label=\"\ud83d\udce9 Download Report (.md)\",\n                data=file_stream,\n                file_name=dl_filename,\n                mime=\"text/markdown\",\n                key=f\"dl_btn_{dl_timestamp}\" # Dynamic key to force re-render\n            )\n        except Exception as e:\n            st.error(f\"Download Error: {e}\")\n            \n    else:\n        report_placeholder.info(\"\ucd5c\uc885 \ubcf4\uace0\uc11c\uac00 \uc0dd\uc131\ub418\ub294 \uc704\uce58\uc785\ub2c8\ub2e4.\")\n    st.markdown('</div>', unsafe_allow_html=True)\n\nst.markdown(\"---\")\nst.markdown('<div style=\"text-align: center; opacity: 0.5; font-size: 0.8em;\">\u00a9 2026 AI \uc790\ub3d9\ud654 \uc5f0\uad6c - Powered by Google Gemini 2.5 Pro & Flash & Claude 4.5 Thinking</div>', unsafe_allow_html=True)\n",
          "agents.py": "import os\nfrom crewai import Agent, LLM\nfrom crewai_tools import TavilySearchTool\n\nclass UltimateResearchAgents:\n    \"\"\"\n    2026\ub144 \ucd5c\uc2e0 3.0 \uc138\ub300 \uac00\uc6a9 \ubaa8\ub378 \ucd5c\uc801\ud654 \uc5d0\uc774\uc804\ud2b8 \ud300\n    \n    [\ud575\uc2ec \uc5c5\ub370\uc774\ud2b8]\n    - 1.5 Pro/Flash \ub2e8\uc885 \ubc18\uc601\n    - 2.5 Pro (Standard) & 3.0 (Preview/Deep Research) \uae30\ubc18 \uad50\uccb4\n    - Tavily + Google Deep Research Pro Preview \uc2dc\ub108\uc9c0\n    \"\"\"\n    def __init__(self):\n        # AI-Optimized Search Tool\n        self.search_tool = TavilySearchTool()\n        \n        # --- 2026 MODEL HIERARCHY ---\n        \n        # 1. Google Gemini 2.5 Flash (Current Stable Speed Tier)\n        self.flash_llm = LLM(\n            model=\"gemini/gemini-2.5-flash\", \n            api_key=os.getenv(\"GOOGLE_API_KEY\")\n        )\n        self.flash_model_name = \"Gemini 3 Flash\"\n        \n        # 2. Claude 4.5 Thinking (Critic)\n        # Fallback to GPT-4o-mini if Anthropic Key is missing\n        claude_key = os.getenv(\"ANTHROPIC_API_KEY\")\n        if claude_key:\n            self.critic_llm = LLM(\n                model=\"anthropic/claude-3-opus-20240229\",\n                api_key=claude_key\n            )\n            self.critic_model_name = \"Claude Opus 4.5 (Thinking Mode)\"\n        else:\n            self.critic_llm = LLM(\n                model=\"gpt-4o-mini\",\n                api_key=os.getenv(\"OPENAI_API_KEY\")\n            )\n            self.critic_model_name = \"GPT-4o-mini (Claude Simulation)\"\n\n        # 3. Google Gemini 2.5 Pro (The Strategic Writer)\n        # Using the standard 2.5 Pro which replaced 1.5 Pro\n        self.pro_llm = LLM(\n            model=\"gemini/gemini-2.5-pro\",\n            api_key=os.getenv(\"GOOGLE_API_KEY\")\n        )\n        self.pro_model_name = \"Gemini 3 Pro (High)\"\n\n    def deep_researcher(self):\n        \"\"\"\n        [Active Model]: Gemini 2.5 Flash\n        \"\"\"\n        return Agent(\n            role=f'Deep Researcher ({self.flash_model_name})',\n            goal='Execute high-speed, high-volume data scraping and validation',\n            backstory=\"\"\"You are the ultimate research speed-demon. \n            Utilizing the Gemini 3 Flash architecture, you scan the web to find \n            the MOST RECENT data points. You do not analyze; you find evidence.\n            CRITICAL: You must verify every link you find. If a link is dead, discard it.\"\"\",\n            tools=[self.search_tool],\n            verbose=True,\n            memory=False,\n            llm=self.flash_llm,\n            allow_delegation=False,\n        )\n\n    def data_analyst(self):\n        \"\"\"\n        [Active Model]: Gemini 2.5 Flash (Fast processing for data)\n        \"\"\"\n        return Agent(\n            role=f'Quant-X Data Analyst ({self.flash_model_name})',\n            goal='Extract numerical data and visualize trends using Mermaid.js',\n            backstory=\"\"\"You are 'Quant-X', a data visualization specialist.\n            You find every number in the text and turn it into a Chart.\n            Your output must be visual (Markdown Tables, Mermaid Charts).\n            You hate vague words like 'significant growth'; you demand percentages.\"\"\",\n            verbose=True,\n            memory=False,\n            llm=self.flash_llm, \n            allow_delegation=False,\n        )\n\n    def chief_skeptic(self):\n        \"\"\"\n        [Active Model]: Claude 4.5 Thinking (or Proxy)\n        \"\"\"\n        return Agent(\n            role=f'Chief Skeptic ({self.critic_model_name})',\n            goal='Host a brutal debate between Optimist and Pessimist views',\n            backstory=\"\"\"You are the 'Dialectic Arena' moderator.\n            You do not just critique; you simulate a fight between:\n            1. The Eternal Optimist (Tech Utopia)\n            2. The Doomsday Pessimist (Risk & Crash)\n            You let them argue, then derive the synthesized truth.\"\"\",\n            verbose=True,\n            memory=False,\n            llm=self.critic_llm,\n            allow_delegation=False,\n        )\n\n    def business_consultant(self):\n        \"\"\"\n        [Active Model]: Gemini 2.5 Pro (Strategic Reasoning)\n        \"\"\"\n        return Agent(\n            role=f'Business Strategist ({self.pro_model_name})',\n            goal='Predict profitability and design execution workflows',\n            backstory=\"\"\"You are a veteran MBB (McKinsey/Bain/BCG) consultant.\n            You calculate TAM/SAM/SOM and ROI projections using the Fermi method.\n            You also design concrete, step-by-step execution workflows (Gantt/PERT).\n            You turn abstract research into money-making logic.\"\"\",\n            verbose=True,\n            memory=False,\n            llm=self.pro_llm,\n            allow_delegation=False,\n        )\n\n    def insight_synthesizer(self):\n        \"\"\"\n        [Active Model]: Gemini 2.5 Pro\n        \"\"\"\n        return Agent(\n            role=f'Strategic Writer ({self.pro_model_name})',\n            goal='Synthesize raw data, charts, debates, and business logic into a 50-page tier report',\n            backstory=\"\"\"You are the master of context. Utilizing Gemini 3 Pro's \n            massive context window, you merge Deep Research, Quant-X Charts, \n            skeptical debates, and business strategies into a single coherent masterpiece.\n            You handle English and Korean with zero loss in nuance.\"\"\",\n            verbose=True,\n            memory=False,\n            llm=self.pro_llm,\n            allow_delegation=False,\n        )\n",
          "tasks.py": "from crewai import Task\nimport re\n\nclass UltimateResearchTasks:\n    \"\"\"\n    Tier-1 Strategy Firm Workflow (v2.0)\n    - Source Validation\n    - Quant-X Visualization\n    - Dialectic Debate\n    - Business Logic (Profit/Workflow)\n    \"\"\"\n    \n    def initial_research_task(self, agent, topic, image_data=None):\n        vision_instruction = \"\"\n        if image_data:\n            vision_instruction = f\"\"\"\n            [VISION INTELLIGENCE ACTIVE]\n            Analyze the attached image context:\n            1. Describe key visual elements.\n            2. Connect these elements to the topic '{topic}'.\n            3. Find external data that validates this visual evidence.\n            \"\"\"\n\n        return Task(\n            description=f\"\"\"Conduct DEEP & VALIDATED web research based on the exact USER COMMAND below:\n            \n            USER COMMAND: \"{topic}\"\n            \n            [VISION INTELLIGENCE]: {vision_instruction}\n\n            [PROTOCOL: SOURCE AUDITOR ACTIVE]\n            - YOU MUST click and verify every link.\n            - If a page is 404 or low quality, DISCARD it instantly.\n            - Only keep \"Golden Sources\" (Official Docs, Tier-1 News, Academic Papers).\n\n            [RESEARCH TARGETS]\n            1. Latest Market Data (2025-2026 Focus)\n            2. Competitor Moves & Hidden Strategies\n            3. Technical Specs / Pricing / Revenue Models\n            \n            OUTPUT FORMAT:\n            - List of Verified Facts with [Source URL]\n            - \"Golden Source\" Verification Status (e.g., \"Link Active: Yes\")\n            \"\"\",\n            expected_output=\"\"\"A validated dossier of facts. source links must be tested and confirmed alive.\n            Focus on hard numbers and strategic moves.\"\"\",\n            agent=agent,\n        )\n\n    def data_visualization_task(self, agent):\n        return Task(\n            description=\"\"\"[QUANT-X ACTIVATED]\n            Review the research findings. Extract ALL numerical data (Revenue, Growth %, Market Size).\n            \n            1. Create a Markdown Table summarizing key financial/usage metrics.\n            2. Generate 'Mermaid.js' code for:\n               - A Pie Chart (Market Share or Cost Breakdown)\n               - A Bar configuration (Growth/Comparison)\n               - A Sequence Diagram (if process-related)\n            \n            DO NOT output images. Output the CODE blocks for Mermaid.\n            \"\"\",\n            expected_output=\"\"\"Markdown tables and valid Mermaid.js code blocks. \n            No vague text. Only Numbers and Charts.\"\"\",\n            agent=agent,\n        )\n\n    def debate_task(self, agent):\n        return Task(\n            description=\"\"\"[THE DIALECTIC ARENA]\n            Initiate a debate between two personas regarding the research findings from the USER COMMAND above:\n            \n            1. THE OPTIMIST (Silicon Valley VC): \"This is the next trillion-dollar opportunity!\"\n            2. THE PESSIMIST (Risk Officer): \"Regulatory hell, tech bubble, and safety risks.\"\n            \n            Conduct 3 rounds of argument.\n            Round 1: Market Potential vs. Bubble Risk\n            Round 2: Technical Feasibility vs. Physical Constraints\n            Round 3: Social Impact vs. Backlash\n            \n            Synthesize the winner's logic into a 'Risk Assessment Matrix'.\n            \"\"\",\n            expected_output=\"\"\"Transcript of the 3-round debate and a Final Risk Assessment Matrix.\n            Highlight the 'Killer Arguments' that won.\"\"\",\n            agent=agent,\n        )\n\n    def business_logic_task(self, agent):\n        return Task(\n            description=\"\"\"[MBB STRATEGY MODULE]\n            Based on the research and debate, generate:\n            \n            1. **Profitability Prediction Model**:\n               - Estimate TAM (Total Addressable Market) / SAM / SOM in USD.\n               - Predict ROI timeline (Break-even point).\n               - Identify 3 high-margin revenue streams.\n               \n            2. **Investment Defense & Risk Hedge**:\n               - Create a \"Risk Hedge Report\" for potential investors.\n               - Analysis of regulatory risks (Global & Local).\n\n            3. **Execution Workflow (The \"How-To\")**:\n               - Create a Step-by-Step Implementation Plan (Phase 1 to Phase 4).\n               - Define Key Milestones & KPIs.\n               - Generate a Mermaid.js GANTT Chart code for this timeline.\n            \"\"\",\n            expected_output=\"\"\"Financial projections (TAM/SAM/SOM), Risk Hedge Report, and a detailed Execution Plan.\"\"\",\n            agent=agent,\n        )\n\n    def final_report_task(self, agent, topic):\n        # Dynamic Korean filename generation\n        safe_topic = re.sub(r'[^\\w\\s-]', '', topic).strip()\n        safe_topic = re.sub(r'[-\\s]+', '_', safe_topic)\n        if not safe_topic:\n            safe_topic = \"Strategic_Report\"\n        \n        filename = f\"Strategy_Report_{safe_topic[:40]}.md\"\n            \n        return Task(\n            description=f\"\"\"Synthesize ALL previous outputs into the 'Ultimate Strategic Report' for '{topic}'.\n            \n            [STRUCTURE]\n            1. **Executive Dashboard**:\n               - 3-Line High-level Summary.\n               - [Quant-X] Insert the key Markdown Tables here.\n            \n            2. **Visual Intelligence & Charts**:\n               - Render the Mermaid.js Charts (Pie/Bar) from the Data Analyst.\n               - Explain the insights derived from these charts.\n            \n            3. **The Dialectic Arena (Risk Analysis)**:\n               - Summarize the Optimist vs. Pessimist debate.\n               - Present the 'Risk Assessment Matrix'.\n            \n            4. **Strategic Execution & Investment Defense**:\n               - [Business Consultant Output] Insert the Profitability Model.\n               - **Risk Hedge Strategy**: How to protect investor capital.\n               - Display the Execution Workflow & Mermaid Gantt Chart.\n               \n            5. **Korean Executive Summary (\ud55c\uad6d\uc5b4 \uc694\uc57d \ubc0f \uc81c\uc5b8)**:\n               - Translate the core insights into perfect professional Korean.\n               - **[K-Compliance Check]**: \n                 verify compliance with 'Data 3 Laws' (Credit/Personal/Network Act) for the Korean market.\n               - Add a specific section: \"To-Do List for Korean Market Entry\".\n             \n            [FORMATTING]\n            - Use ````mermaid` blocks for charts.\n            - Use bolding for key financial figures.\n            - Tone: MBB Senior Partner (McKinsey/Bain/BCG).\n            \n            [SOULLESS MODE v11.0 CHECK]\n            Include the JSON self-evaluation block at the very end.\n            \"\"\",\n            expected_output=\"\"\"A Masterpiece Report containing text, tables, mermaid charts, debate summaries, and financial models. \n            Bilingual (English Main + Korean Summary).\"\"\",\n            agent=agent,\n            output_file=filename,\n        )\n",
          ".env": "# Required for Gemini\nGOOGLE_API_KEY=AIzaSyDIhacQC4mVCslpT_mV7rxrqEs28tHRZPI\n\n# Required for AI-Optimized Web Search (Tavily - 2026 Standard)\n# Get your free API key at: https://tavily.com\nTAVILY_API_KEY=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\n\n# CrewAI sometimes requires this even when using Gemini\n# You can use a dummy value if only using Gemini\nOPENAI_API_KEY=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\n"
        },
        stliteConfig: {
          platform: "browser"
        }
      }, document.getElementById("root"));
    </script>
  </body>
</html>